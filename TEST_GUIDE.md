# 🧪 용돈관리 앱 테스트 가이드

## 🎯 테스트 목표
1. **'쓴 돈' 통계 실시간 반영** 확인
2. **부모-자녀 거래내역 실시간 동기화** 확인

## 📋 테스트 시나리오

### 1. '쓴 돈' 통계 실시간 반영 테스트

#### 준비사항
- 브라우저 두 개 탭: 하나는 용돈 페이지, 하나는 콘솔(F12)
- 현재 잔액과 통계 확인

#### 테스트 단계
1. **현재 상태 확인**
   ```
   - 용돈 페이지 로드
   - F12 콘솔에서 다음 로그 확인:
   📊 [DEBUG] 통계 정보 로드 완료: {currentBalance: X, totalExpense: Y}
   💰 [DEBUG] getCurrentBalance 조회: {balance: Z}
   ```

2. **지출 거래 추가**
   ```
   - + 버튼 클릭
   - 지출 선택 (빨간색)
   - 금액: 예시 5000원
   - 설명: "테스트 지출"
   - 카테고리: "간식" 
   - 추가하기 클릭
   ```

3. **콘솔 로그 확인 (중요!)**
   ```
   예상 로그:
   🔍 [DEBUG] 거래 추가하는 사용자 정보
   ✅ 거래 추가 성공: {transactionId: "xxx", amount: 5000, type: "expense"}
   💰 [DEBUG] 잔액 업데이트: {currentAmount: X, newBalance: X-5000}
   ✅ 잔액 업데이트 성공: (새로운 잔액)
   🔄 [DEBUG] 데이터 새로고침 시작...
   📊 [DEBUG] 통계 정보 로드 완료: {새로운 통계}
   ```

4. **UI 반영 확인**
   ```
   - "쓴 돈" 카드의 숫자가 즉시 업데이트 되었는지 확인
   - 잔액이 올바르게 차감되었는지 확인
   - 새로 추가된 거래가 목록에 표시되는지 확인
   ```

### 2. 부모-자녀 거래내역 실시간 동기화 테스트

#### 준비사항 (가장 중요!)
- **부모 계정**으로 브라우저 1개 열기
- **자녀 계정**으로 브라우저 1개 더 열기 (다른 브라우저 또는 시크릿 모드)
- 각각 F12 콘솔 열어두기

#### 테스트 단계

1. **부모 브라우저에서 실행**
   ```
   - 용돈 페이지 접속
   - F12 콘솔에서 확인:
   📡 [DEBUG] 실시간 구독 설정: {userType: "parent", childrenIds: [...]}
   ✅ 실시간 구독 설정 완료
   ```

2. **자녀 브라우저에서 실행**
   ```
   - 용돈 페이지 접속  
   - F12 콘솔에서 확인:
   📡 [DEBUG] 실시간 구독 설정: {userType: "child", parentId: "xxx"}
   ✅ 실시간 구독 설정 완료
   ```

3. **부모가 거래 추가 (핵심 테스트!)**
   ```
   부모 브라우저에서:
   - + 버튼 클릭
   - 거래 추가 (예: 수입 10000원, "용돈 지급")
   - 추가하기 클릭
   
   부모 콘솔 확인:
   🔄 [DEBUG] 실시간 동기화 알림 준비: {userType: "parent", childrenIds: [...]}
   🔄 실시간 알림 전송: (자녀ID)에게 거래 추가 알림
   ```

4. **자녀 브라우저 반응 확인**
   ```
   자녀 콘솔에서 다음 로그가 나와야 함:
   📡 enhancedSync 실시간 업데이트 수신: {type: "transaction_added"}
   🔄 새 거래 알림 수신, 데이터 새로고침 중...
   📡 [DEBUG] Supabase 거래내역 쿼리 결과: {totalCount: (증가된 수)}
   📊 [DEBUG] 최종 거래내역 상세: (새로운 거래 포함)
   ```

5. **자녀 UI 확인**
   ```
   - 새로 추가된 부모의 거래가 자동으로 목록에 나타나는지 확인
   - 통계 정보(잔액, 받은 돈 등)가 업데이트되는지 확인
   - 페이지를 새로고침하지 않았는데도 실시간으로 반영되는지 확인
   ```

## 🚨 문제 발생 시 체크포인트

### '쓴 돈' 통계가 반영 안될 때
1. 콘솔에서 `💰 [DEBUG] 잔액 업데이트` 로그가 있는지 확인
2. `✅ 잔액 업데이트 성공` 로그가 있는지 확인
3. `📊 [DEBUG] 통계 정보 로드 완료`에서 새로운 값이 나오는지 확인

### 부모-자녀 동기화가 안될 때
1. 양쪽 브라우저에서 `📡 [DEBUG] 실시간 구독 설정` 로그 확인
2. 부모 브라우저에서 `🔄 실시간 알림 전송` 로그 확인
3. 자녀 브라우저에서 `📡 enhancedSync 실시간 업데이트 수신` 로그 확인
4. 가족 관계 설정 확인: `🔍 [자동진단] 가족 관계 확인 중` 로그

## 🔧 개발자 도구 활용법

### 콘솔에서 확인해야 할 핵심 로그들
```
✅ 성공 로그 (초록색)
🔍 디버그 로그 (파란색) 
🔄 동기화 로그 (주황색)
📡 실시간 로그 (보라색)
💰 잔액 로그 (노란색)
📊 통계 로그 (회색)
❌ 에러 로그 (빨간색)
```

### 네트워크 탭에서 확인사항
- allowance_transactions 테이블 INSERT 요청
- allowance_balances 테이블 UPSERT 요청
- 실시간 WebSocket 연결 상태

## 🎉 테스트 성공 기준

### '쓴 돈' 통계 테스트 성공
- [x] 지출 추가 시 즉시 잔액 차감
- [x] 통계 카드의 "쓴 돈" 즉시 업데이트
- [x] 관련 디버그 로그 모두 출력
- [x] 에러 로그 없음

### 부모-자녀 동기화 테스트 성공  
- [x] 부모 거래 추가 시 자녀 화면 자동 업데이트
- [x] 실시간 알림 로그 정상 출력
- [x] 양방향 구독 설정 성공
- [x] 새로고침 없이 실시간 반영

## 🚀 테스트 실행

**지금 바로 http://localhost:3002 에서 위 시나리오를 따라 테스트해보세요!**